<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Spion Spiel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f0f0f0; }
    .hidden { display: none; }
    .screen { padding: 20px; text-align: center; }
    .card { display: inline-block; margin: 10px; padding: 30px; background: #3498db; color: white; border-radius: 10px; cursor: pointer; font-size: 1.2rem; width: 150px; height: 100px; }
    .card.revealed { background: #2ecc71; color: black; }
    button { margin: 10px; padding: 10px 20px; font-size: 1rem; }
  </style>
</head>
<body>
  <div id="menu" class="screen">
    <h1>Spion Spiel</h1>
    <label>Spieleranzahl: <input type="number" id="spieleranzahl" value="4" min="3" max="20"></label><br><br>
    <label>Impostoranzahl: <input type="number" id="impostoranzahl" value="1" min="1"></label><br><br>
    <div id="spielernamen"></div>
    <button onclick="spielerNamenErstellen()">Spielernamen generieren</button>
    <br><br>
    <button onclick="spielStarten()">Spielen</button>
  </div>

  <div id="spiel" class="screen hidden">
    <h2>Wort anzeigen</h2>
    <div id="karten"></div>
    <br>
    <button onclick="aufloesen()">Auflösen</button>
  </div>

  <div id="ergebnis" class="screen hidden">
    <h2>Impostor war(en):</h2>
    <p id="impostor-namen"></p>
    <button onclick="spielStarten()">Erneut spielen</button>
    <button onclick="zurueckZumMenue()">Menü</button>
  </div>

  <script>
    const woerter = ["Baum", "Wiese", "Wind", "Berg", "See"];
    let spieler = [];
    let impostors = [];
    let wort = "";

    function spielerNamenErstellen() {
      const anzahl = parseInt(document.getElementById("spieleranzahl").value);
      const container = document.getElementById("spielernamen");
      container.innerHTML = "";
      for (let i = 0; i < anzahl; i++) {
        container.innerHTML += `<input type="text" placeholder="Spieler ${i + 1}" id="spieler-${i}"/><br>`;
      }
    }

    function spielStarten() {
      document.getElementById("menu").classList.add("hidden");
      document.getElementById("spiel").classList.remove("hidden");
      const anzahl = parseInt(document.getElementById("spieleranzahl").value);
      let impostorCount = parseInt(document.getElementById("impostoranzahl").value);
      spieler = [];
      for (let i = 0; i < anzahl; i++) {
        let name = document.getElementById(`spieler-${i}`)?.value || `Spieler ${i + 1}`;
        spieler.push({ name, wort: null });
      }

      // Sonderfälle einbauen (1 % Chance auf mehr/weniger Impostors)
      const zufall = Math.random();
      if (zufall < 0.01) impostorCount = 0;
      else if (zufall > 0.99) impostorCount = spieler.length;
      else if (zufall > 0.97) impostorCount = Math.min(spieler.length, impostorCount + 1);

      wort = woerter[Math.floor(Math.random() * woerter.length)];
      impostors = [];
      let indices = [...Array(spieler.length).keys()];
      indices.sort(() => 0.5 - Math.random());
      for (let i = 0; i < impostorCount; i++) {
        impostors.push(indices[i]);
      }

      for (let i = 0; i < spieler.length; i++) {
        spieler[i].wort = impostors.includes(i) ? "Impostor" : wort;
      }

      const kartenDiv = document.getElementById("karten");
      kartenDiv.innerHTML = "";
      spieler.forEach((s, index) => {
        const div = document.createElement("div");
        div.className = "card";
        div.textContent = s.name;
        div.onclick = () => {
          if (div.classList.contains("revealed")) {
            div.textContent = s.name;
            div.classList.remove("revealed");
          } else {
            div.textContent = s.wort;
            div.classList.add("revealed");
          }
        };
        kartenDiv.appendChild(div);
      });
    }

    function aufloesen() {
      document.getElementById("spiel").classList.add("hidden");
      document.getElementById("ergebnis").classList.remove("hidden");
      const namen = impostors.map(i => spieler[i].name);
      document.getElementById("impostor-namen").textContent = namen.length > 0 ? namen.join(", ") : "Niemand war Impostor!";
    }

    function zurueckZumMenue() {
      document.getElementById("ergebnis").classList.add("hidden");
      document.getElementById("menu").classList.remove("hidden");
    }

    // Initial Spielereinträge anzeigen
    spielerNamenErstellen();
  </script>
</body>
</html>
